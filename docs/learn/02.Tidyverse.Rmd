---
title: "Data Manipulation & Visualization"
subtitle: "An Introduction to the {tidyverse} with {refugees} & {unhcthemes}"
output: 
  unhcrdown::html_slides:
    self_contained: true
    nature:
      highlightStyle: github
      highlightLines: true
      ratio: "16:9"
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
library(ragg)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#",
  dev = "ragg_png",
  fig.showtext = TRUE,
  fig.retina = 2,
  dpi = 300
)
library(tidyverse)
library(unhcrthemes)

```



# Learning objectives

- An intro to Rstudio Development Interface
- Basic of the grammar of data manipulation with[`dplyr`](https://dplyr.tidyverse.org/) & [`tidyr`](https://tidyr.tidyverse.org/) using [{refugees}](https://www.unhcr.org/refugee-statistics/insights/explainers/refugees-r-package.html) package.
- Basic of the grammar of graphics and [**`ggplot2`**](https://ggplot2.tidyverse.org/index.html)
- Best practices to create **UNHCR branded** visuals with [**`unhcrthemes`**](https://vidonne.github.io/unhcrthemes/) package




# Learning stages...

.pull-left[

![](img/learning.png)
]

.pull-right[

 __Step 1.__ Develop an understanding of what data science is and what programming and math concepts are needed for it
 
 __Step 2.__ Break data science challenges into small steps - Acquire basic command syntax through very practical and focused project
 
 __Step 3.__ Develop Reproducible Analysis Workflow - Understand the relevance, inputs, constraints, and limitations of the various techniques
 
 __Step 4.__ Optimize your problem solving approaches in elegant ways - Build packages

]

???
https://towardsdatascience.com/the-stages-of-learning-data-science-3cc8be181f54 

See Video - https://www.youtube.com/watch?v=hpMc6TgT34I 
 

---
class: inverse, center, middle

# Using Rstudio


---

## Integrated Development Interface (IDE)

Environment
History
Files
Plots
Packages
Help
Source
Console/Terminal

---

## Rstudio - Source
Where you write your R code or document content
If you are writing a R Markdown document, you can render it in this area using the                  button
To run a R code, you can use the shortcut Crtl + Enter

---

## Rstudio – Console/Terminal
Where you can check the execution of commands and where the code is evaluated
Can perform quick calculations (that you do not need to save)


---

## Rstudio - Environment/History
Where you can see the objects in your working space 
You can also view your command history (History tab) 

---

## Rstudio – Files/Plots/Packages/Help
You can see the file directories
View plots
View which R packages are installed. You can also update the packages
R help


---
class: inverse, center, middle

# `refugees` with  `dplyr` & `tidyr`

---

### Install required packages

Got to your [locally installed Rstudio](https://www.rstudio.com/products/rstudio/download/#download) or [sign-up for a free Rstudio Cloud account](https://login.rstudio.cloud/register?redirect=https%3A%2F%2Fclient.login.rstudio.cloud%2Foauth%2Flogin%3Fshow_auth%3D0%26show_login%3D0)

.pull-left[

First create a new project within R studio and then make sure we have the [tidyverse](https://www.tidyverse.org/packages/) plus additional UNHCR packages

```{r, comment='#', evaluate = FALSE} 
# Tidyverse
if (!require("tidyverse")) install.packages("tidyverse", dependencies = TRUE)
if (!require("here")) install.packages("here")

# UnhcRverse  



```
]

 
.pull-right[
```{r, echo = FALSE}
library(tidyverse)
```


![tidyverse](img/forcats.png)  


]

???

The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.




---

## Refugees Package

Data can be published as a package. An easy-to-use interface to the datasets served normally through the API, which cover forcibly displaced populations, including refugees, asylum-seekers and internally displaced people, stateless people, and others over a span of more than 70 years. This package provides data from three major sources:

 * Data from UNHCR’s annual statistical activities dating back to 1951.
 
 * Data from the United Nations Relief and Works Agency for Palestine Refugees in the Near East (UNRWA), specifically for registered Palestine refugees under UNRWA’s mandate. 
 
 * Data from the Internal Displacement Monitoring Centre (IDMC) on people displaced within their country due to conflict or violence.

---

## 8 datasets:

 1. `population`: Data on forcibly displaced and stateless persons by year, including refugees, asylum-seekers, internally displaced people (IDPs) and stateless people. Detailed definitions of the different population groups can be found on the methodology page of the Refugee Data Finder.
 
 2. `idmc`: Data from the Internal Displacement Monitoring Centre on the total number of IDPs displaced due to conflict and violence.
 
 3. `asylum_applications`: Data on asylum applications including the procedure type and application type.
 
 4. `asylum_decisions`: Data on asylum decisions, including recognitions, rejections, and administrative closures.
 
 5.`demographics`: Demographic and sub-national data, where available, including disaggregation by age and sex.

 6. `solutions`: Data on durable solutions for refugees and IDPs.
  
 7. `unrwa`: Data on registered Palestine refugees under UNRWA’s mandate.
 
 8. `flows`: Numbers of the people forced to flee during each of the years since 1962. For more information, see the explaination of the forced displacement flow dataset.

---

## Data Manipulation

```
library(refugees)
library(dplyr)
library(tidyr)

ref_coo_10 <- refugees::population |>
  dplyr::filter(year == 2022) |>
  dplyr::summarise(refugees = sum(refugees, na.rm = TRUE) + sum(oip, na.rm = TRUE),
            .by = coo_name) |>
  dplyr::slice_max(order_by = refugees, n = 10)
```


---

## Data Manipulation

```
fd_last_ten_years <- refugees::population |>
  filter(year >= 2022-9) |>
  summarise(refugees = sum(refugees, na.rm = TRUE),
            asylum_seekers = sum(asylum_seekers, na.rm = TRUE), 
            oip = sum(oip, na.rm = TRUE), .by = year) |>
  left_join(refugees::idmc |> 
              filter(year >= 2022-9) |>
              summarise(idmc = sum(total, na.rm = TRUE), .by = year), by=c(“year”)) |>
  left_join(refugees::unrwa |> 
              filter(year >= 2022-9) |>
              summarise(unrwa = sum(total, na.rm = TRUE), .by = year), by=c(“year”)) |>
  pivot_longer(cols = -year, names_to = “population_type”, values_to = “total”) |> 
  mutate(population_type=factor(population_type, levels=c(“oip”, “unrwa”,“asylum_seekers”, “refugees”,“idmc”)), 
             population_type=recode(population_type,
             refugees=“Refugees under UNHCR’s mandate”,
             asylum_seekers=“Asylum-seekers”,
             oip=“Other people in need of international protection”,
             idmc=“Internally displaced persons”,
             unrwa=“Palestine refugees under UNRWA’s mandate”)) |>
  arrange(year, population_type)
```

---

## Data Manipulation

```
demo_2022 <- refugees::demographics |> 
  filter(year==2022 & 
  pop_type %in% c(“REF”, “ASY”, “IDP”, “OIP”, “RDP”, “RET”, “STA”, “OOC”)) |>
  
  summarise(“male 0-17” = sum(m_0_4, na.rm = TRUE) + 
                          sum(m_5_11, na.rm = TRUE) + 
                          sum(m_12_17, na.rm = TRUE),
            “male 18-59”= sum(m_18_59, na.rm = TRUE), 
            “male 60+”=sum(m_60, na.rm=TRUE), 
            “female 0-17” = sum(f_0_4, na.rm = TRUE) + 
                            sum(f_5_11, na.rm = TRUE) + 
                            sum(f_12_17, na.rm = TRUE),
            “female 18-59”= sum(f_18_59, na.rm = TRUE), 
            “female 60+”=sum(f_60, na.rm=TRUE)) |>
            
  pivot_longer(cols=everything(), 
               names_sep = “ “, 
               names_to = c(“.value”, “ages”)) |>
  mutate(male_p = round(male/(sum(female)+sum(male)),2),   
         female_p = round(female/(sum(female)+sum(male)),2)) |>
  
```




---
class: inverse, center, middle

# `ggplot2` and `unhcrthemes`

### Introduction

---

## The `ggplot2` package

.pull-left[

- **`ggplot2`** is an R package for declaratively creating graphics

- **`ggplot2`** is an implementation [The Grammar of Graphics](https://link.springer.com/chapter/10.1007/978-3-642-21551-3_13) by Leland Irving

- **The idea** don't start with the final form of the graphic (Excel approach) but **decompose the graphic** into its constituents

]

.pull-right[

.center[![ggplot2 HEX](https://raw.githubusercontent.com/tidyverse/ggplot2/main/man/figures/logo.png)]

]


???
You provide the data, tell ggplot2 how to map variables to aesthetics, what graphical primitives to use, and it takes care of the details.
What does it take to create a graphic? Data, axis, geometric objects, etc.

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 1), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 2), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 3), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 4), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 5), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 6), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 7), format = 'html') |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## Structure of `ggplot2`

How a **`ggplot2`** graph is built on the grammar of graphics elements:

```{r, echo=FALSE}
ggplot <- read_csv("data/ggplot.csv")
kableExtra::kbl(head(ggplot, 8), format = 'html', caption = "Credit: Cedric Scherer") |> 
  kableExtra::kable_styling(font_size = 16) |> 
  kableExtra::column_spec(1, bold = TRUE) |> 
  kableExtra::column_spec(2, bold = TRUE, color = "#0072bc")

```

???
1. Data - without data, you don't have a plot!
2. Mapping - linking variables to graphical properties.
3. Geometries - interpret aesthetics as graphical representations.
4. Statistics - compute/transform numbers for us.
5. Scales - interpret values in data to graphical properties.
6. Coordinates - define physical mapping.
7. Facets - split plot into panels.
8. Theme - what does your plot look like?

---

## `unhcrthemes` package

.pull-left[

1. **Branded** `ggplot2` theme

]

.pull-right[

```{r, echo=FALSE, fig.height=5}
data(idp, package = "unhcrthemes")

idp_total <- idp |>
  group_by(year) |>
  summarise(idp = sum(idp, na.rm = TRUE) / 1e6) |>
  ungroup()

ggplot(idp_total) +
  geom_col(aes(x = year, y = idp),
           fill = unhcr_pal(n = 1, "pal_blue"),
           width = 0.8) +
  labs(title = "Globalement IDP displacement | 2010 - 2020",
       y = "Number of people (in million)",
       caption = "Source: UNHCR Refugee Data Finder\n© UNHCR, The UN Refugee Agency") +
  scale_y_continuous(expand = expansion(c(0, 0.1))) +
  scale_x_continuous(breaks = scales::pretty_breaks(10)) +
  theme_unhcr(grid = "Y", axis_title = "y")

```

]

---

## `unhcrthemes` package

.pull-left[

1. **Branded** `ggplot2` theme

2. A series of color palette for:

    - A **categorical palette** for UNHCR main data visualization colors

    - A **categorical palette** for people of concern to UNHCR categories

    - A **categorical palette** for geographical regional divisions of UNHCR

    - Six **sequential color palettes** for all the main data visualization colors

    - Two recommended **diverging color palette**

]

.pull-right[


```{r, echo=FALSE,fig.height=4.5}
display_unhcr_all()
```

]

---

## `unhcrthemes` package

.pull-left[

1. **Branded** `ggplot2` theme

2. A series of color palette for:

    - A **categorical palette** for UNHCR main data visualization colors

    - A **categorical palette** for people of concern to UNHCR categories

    - A **categorical palette** for geographical regional divisions of UNHCR

    - Six **sequential color palettes** for all the main data visualization colors

    - Two recommended **diverging color palette**
    
3. Available on [github](https://github.com/vidonne/unhcrthemes/), dedicated [documentation page](https://vidonne.github.io/unhcrthemes/index.html) and throughout [examples of the data visualization platform](https://dataviz.unhcr.org/tools/r/).

]

.pull-right[

.center[<img src="https://raw.githubusercontent.com/vidonne/unhcrthemes/master/man/figures/unhcrthemes_sticker.png" alt="unhcrthemes HEX" style="max-width:60%">]

]


---
class: inverse, center, middle

# `ggplot2` and `unhcrthemes`

### In action


---

## Aim

.pull-left[

Replicate a chart example from the [Global Trends 2021](https://www.unhcr.org/globaltrends.html) webpage, using `ggplot2` and make it brand compliant with `unhcrthemes` packages.


]

.pull-right[


```{r, echo=FALSE, fig.height=6}
fd_last_ten_years <- fd_last_ten_years |>
  ggplot() +
  geom_area(aes(x = year, y = total, fill = population_type)) +
  scale_fill_unhcr_d(palette = “pal_unhcr”) +
  labs(title = “People forced to flee | 2013 - 2022”, y = “Number of people”, caption = “Source: UNHCR Refugee Data Finder”) +
  scale_x_continuous(breaks = pretty_breaks(n = 10)) +
  scale_y_continuous(expand = expansion(c(0, 0.1)), breaks= pretty_breaks(n = 5), labels = label_number(scale_cut = cut_long_scale())) +  
  theme_unhcr(font_size = 20,
    grid = “Y”,
    axis = “x”,
    axis_title = “y”) +
    scale_fill_manual(values = c(“#EF4A60”,“#8EBEFF”,“#18375F”,“#0072BC”, “#00B398”)) +
guides(fill = guide_legend(nrow = 3, byrow = TRUE, reverse = TRUE)) 
  
fd_last_ten_years
```

]

---

## Setup

.pull-left[


```{r, eval=FALSE}
# Install packages 
# if needed uncomment lines below
# install.packages('tidyverse')
# remotes::install_github("vidonne/unhcrthemes") 

# Load packages
library(tidyverse)
library(unhcrthemes)

# Load data
displ <- read_csv("data/displaced_pop.csv")

# Check data structure
View(displ)
```

]

.pull-right[


```{r, echo=FALSE}
knitr::kable(head(displ), format = 'html', col.names = c("Year", "Population type", "# of people"))
```

]

---

## Data

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ) #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ)
```

]

???
1. Data - without data, you don't have a plot!
But nothing happens here because we haven't mapped the raw data to anything. SO we just get a empty canvas.

---

## Aesthetics

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num))  #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(
         x = year,
         y = num
       ))
```

]

???
2. Mapping - linking variables to graphical properties.
We have now mapped the year to the x axis and the number displaced to y but we still don't see anything special except the axis value

---

## Geoms

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col()
```

]

---

## Scale

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous( #<<
    breaks = scales::pretty_breaks(n = 10)) #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10))
```

]

---

## Scale

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous( #<<
    labels = scales::label_number_si(), #<<
    expand = expansion(c(0, 0.1))) #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1)))
```

]

---

## Context

.pull-left[

Before playing with `unhcthemes` let's add some information on the chart.

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022", #<<
    caption = "Source: UNHCR Refugee Data Finder") #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder")
```

]

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr() #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr()
```

]

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y", #<<
              axis_title = FALSE) #<<
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col(
    color = unhcr_pal(n = 1, name = "pal_blue") #<<
    ) +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE) 
```

]

--

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col(
    color = unhcr_pal(n = 1, name = "pal_blue")
  ) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]

???
Is color the right property?
Also notice that we haven't mapped the color to anything but we're just setting it.

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col(
    fill = unhcr_pal(n = 1, name = "pal_blue") #<<
    ) +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE) 
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num)) +
  geom_col(
    fill = unhcr_pal(n = 1, name = "pal_blue")
  ) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]

???
Is color the right property?
Also notice that we haven't mapped the color to anything but we're just setting it.

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop)) + #<<
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE) 
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop, group = pop)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  scale_fill_discrete(guide=guide_legend(reverse = TRUE)) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  scale_fill_unhcr_d() + #<<
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE) 
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop, group = pop)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  scale_fill_unhcr_d(guide=guide_legend(reverse = TRUE), direction = -1) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]

---

## unhcrthemes

.pull-left[

**Recommended colours from dataviz guideline**

![Colour palette for UNHCR's people of concerns](img/poc_palette.png)

]

.pull-right[

**Check available colours in the package**

```{r, fig.height=5}
display_unhcr_all()
```

]


---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  scale_fill_unhcr_d(
    palette = "pal_unhcr_poc" #<<
  ) + 
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE) 
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop, group = pop)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  scale_fill_unhcr_d(guide=guide_legend(reverse = TRUE), direction = -1,
                     palette = "pal_unhcr_poc") +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]

---

## unhcrthemes

.pull-left[

```{r, eval=FALSE}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop)) +
  geom_col() +
  scale_x_continuous(
    breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(
    labels = scales::label_number_si(), 
    expand = expansion(c(0, 0.1))) +
  scale_fill_unhcr_d(
    palette = "pal_unhcr_poc",
    nmax = 9, order = c(4, 1:3, 9, 8) #<<
  ) + 
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE) 
```

]

.pull-right[

```{r, echo=FALSE, fig.height=6}
ggplot(data = displ,
       aes(x = year, y = num,
           fill = pop, group = pop)) +
  geom_col() +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 10)) +
  scale_y_continuous(labels = scales::label_number_si(),
                     expand = expansion(c(0, 0.1))) +
  scale_fill_unhcr_d(guide=guide_legend(reverse = TRUE), direction = -1,
                     palette = "pal_unhcr_poc",
                     nmax = 9, order = c(4, 1:3, 9, 8)) +
  labs(title = "People forced to flee worldwide | 2012-2022",
    caption = "Source: UNHCR Refugee Data Finder") +
  theme_unhcr(grid = "Y",
              axis_title = FALSE)
```

]



---
class: inverse, center, middle

# Thank you

### Questions?


???
Resources Ggplot:

- [Ggplot main doc](https://ggplot2.tidyverse.org/index.html)
- [The ggplot flipbook](https://evamaerey.github.io/ggplot_flipbook/ggplot_flipbook_xaringan.html#1) by Gina Reynolds
- [A ggplot2 tutorial for beautiful plotting in R](https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/) and [ggplot Wizardry Hands-On](https://z3tt.github.io/OutlierConf2021/) by Cedric Scherer
- Ggplot workshop [Part1](https://www.youtube.com/watch?v=h29g21z0a68)/[Part2](https://www.youtube.com/watch?v=0m4yywqNPVY) by Thomas Lin Pedersen (one of the main maintainer of ggplot)


